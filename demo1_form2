using System;
using System.Text;
using System.Windows.Forms;
using System.Runtime.InteropServices;

namespace demo
{
    public partial class Form2 : Form
    {
        //無邊框移動表單宣告
        [DllImport("user32.dll")]
        public static extern bool ReleaseCapture();

        [DllImport("user32.dll")]
        public static extern bool SendMessage(IntPtr hwnd, int wMsg, int wParam, int lParam);
        public const int WM_SYSCOMMAND = 0x0112;
        public const int SC_MOVE = 0xF010;
        public const int HTCAPTION = 0x0002;

        //form1 textbox1 傳值給 form2
        private string string1;
        public string String1
        {
            set
            {
                string1 = value;
            }
        }

        public Form2()
        {
            InitializeComponent();

            //無邊框移動表單 
            this.FormBorderStyle = System.Windows.Forms.FormBorderStyle.None;
            this.MouseDown += new MouseEventHandler(this.MouseDown1);
            this.MouseMove += new MouseEventHandler(this.MouseMove1);
        }

        private void Config_Load(object sender, EventArgs e)
        {

        }

        //無邊框移動表單Mouse down
        private void MouseDown1(object sender, MouseEventArgs e)
        {
            if (e.Y > 65)
                return;
            ReleaseCapture();
            SendMessage(this.Handle, WM_SYSCOMMAND, SC_MOVE + HTCAPTION, 0);
        }

        //無邊框移動表單Mouse Move
        private void MouseMove1(object sender, MouseEventArgs e)
        {
            if (e.Y < 65)
                this.Cursor = Cursors.SizeAll;
            else
                this.Cursor = Cursors.Default;
        }

        private void button1_Click(object sender, EventArgs e)
        {
            //寫入 ini by Source
            //string _sPath = "D:\\work\\C#\\20180305\\demo2\\demo\\bin\\Debug\\demo.ini";
            string _sPath = string1;
            Actini.Program.WriteIni("Source", "COM", comboBox1.Text, _sPath);
            Actini.Program.WriteIni("Source", "BaudRate",textBox1.Text , _sPath);
            Actini.Program.WriteIni("Source", "Parity", comboBox2.Text, _sPath);
            Actini.Program.WriteIni("Source", "DataBits", comboBox3.Text, _sPath);
            Actini.Program.WriteIni("Source", "StopBits", comboBox4.Text, _sPath);

            this.Close();
            Form1 f1 = new Form1();
            f1.Show();
        }
    }
}
